// SPDX-License-Identifier: GPL-2.0 OR MIT
/*
 * Copyright (C) 2024 Yangyu Chen <cyy@cyyself.name>
 */

#include "k1.dtsi"
#include "k1-pinctrl.dtsi"

/ {
	model = "Banana Pi BPI-F3";
	compatible = "bananapi,bpi-f3", "spacemit,k1";

	aliases {
		serial0 = &uart0;
	};

	chosen {
		stdout-path = "serial0";
	};

	leds {
		compatible = "gpio-leds";

		led1 {
			label = "sys-led";
			gpios = <&gpio K1_GPIO(96) GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "heartbeat";
			default-state = "on";
		};
	};
};

&emmc {
	bus-width = <8>;
	mmc-hs400-1_8v;
	mmc-hs400-enhanced-strobe;
	non-removable;
	no-sd;
	no-sdio;
	status = "okay";
};

&uart0 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart0_2_cfg>;
	status = "okay";
};

&pdma0 {
	status = "okay";
};

&i2c2 {
	status = "okay";
	pinctrl-0 = <&i2c2_4_cfg>;
	pinctrl-names = "default";

	es8326: es8326@19{
		compatible = "everest,es8326";
		reg = <0x19>;
		#sound-dai-cells = <0>;
		interrupt-parent = <&gpio>;
		interrupts = <&gpio K1_GPIO(126) 1>;
		spk-ctl-gpio = <&gpio K1_GPIO(127) 0>;
		everest,mic1-src = [44];
		everest,mic2-src = [66];
		status = "okay";
	};
};

&i2s0 {
	status = "okay";
	pinctrl-0 = <&sspa0_3_cfg>;
	pinctrl-names = "default";
};

&sound_card {
	/*mclk-fs = <256>;*/
	simple-audio-card,mclk-fs = <256>;
	simple-audio-card,dai-link@0 {
		reg = <0>;
		format = "i2s";
		frame-master = <&link0_cpu>;
		bitclock-master = <&link0_cpu>;

		link0_cpu: cpu {
			sound-dai = <&i2s0>;
		};

		link0_codec: codec {
			sound-dai = <&es8326>;
		};
	};
};

&emac0 {
	pinctrl-names = "default";
	pinctrl-0 = <&gmac0_1_cfg>;
};
